<% include ../_header.ejs %>

<div class="row">
    <div class="large-12 large-centered small-11 small-centered columns">
        <h3>Update Device Type</h3>
        <%if(status === "Error") { %>
        <div class="alert alert-danger" role="alert"><%=statusDescription%></div>
        <% } %>
        <table>
          <thead>
            <tr>
              <th width="40">ID</th>
              <th>Name</th>
              <th>Model</th>
              <th>Manufacturer</th>
              <th width="150">Description</th>
              <th width="150">Label</th>
              <th># Devices</th>
            </tr>
          </thead>
          <tbody>
              <% records.map(function(record){%>
                  <tr>
                      <td>
                          <a href="/<%= nicename %>/<%= record.id %>">
                              <%= record.id %>
                          </a>
                      </td>
                      <td><%= record.name %></td>
                      <td><%= record.model %></td>
                      <td><%= record.manufacturer %></td>
                      <td><%= record.description %></td>
                      <td><%= record.label %></td>
                      <td class="device-count" data-typeid="<%= record.id%>">--</td>
                  </tr>
              <%});%>
          </tbody>
        </table>
        <a href="/<%= nicename %>/new" class="button success">Add Record</a>
    </div>
</div>

<script>
    function countDevicesForType($el, typeId){
        var url = '/device/count?where={"type":"'+typeId+'"}';
        console.log('typeId', typeId, url);
        io.socket.get(url, function(re){
            $el.text(re.count);
        });
    }
    function countDevices(){
        $('.device-count').each(function(){
            var id = $(this).data('typeid');
            countDevicesForType($(this), id);
        });
    }

    countDevices()
</script>
